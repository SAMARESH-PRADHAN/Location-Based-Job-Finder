
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Contact Management Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Bootstrap Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    /* body {
      background: linear-gradient(135deg, #667eea, #764ba2);
      min-height: 100vh;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
    } */
    #con-con {
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, #667eea, #764ba2);
  min-height: 100vh;
  color: #fff;
  font-family: 'Segoe UI', sans-serif;
  text-align: center;
  flex-direction: column;
}

    .container {
      padding-top: 60px;
      
    }

    .contact-card {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
    }

    .contact-card:hover {
      transform: translateY(-5px);
    }

    .contact-read {
      border-left: 5px solid #28a745;
    }

    .contact-unread {
      border-left: 5px solid #ffc107;
    }

    .contact-title {
      font-size: 1.2rem;
      font-weight: bold;
    }

    .mark-read-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #fff;
      color: #333;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      transition: 0.3s ease;
    }

    .mark-read-btn:hover {
      background: #28a745;
      color: white;
    }

    .filter-bar {
      background-color: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 25px;
    }

    .pagination {
      justify-content: center;
    }

    .page-item .page-link {
      background-color: #fff;
      color: #333;
      border-radius: 6px;
      margin: 0 3px;
    }

    .page-item.active .page-link {
      background-color: #ffc107;
      color: #000;
    }
    .filter-btn.active {
  background: #ffc107;
  color: #000;
  font-weight: bold;
    }

  </style>
</head>
<body>
<main id="con-con">
<div class="container">
  <h2 class="text-center text-white mb-4"><i class="fas fa-address-book"></i> Contact Management</h2>

  <div class="col-md-6 d-flex gap-2 mt-2">
    <button class="btn btn-outline-light filter-btn active" data-filter="all">All</button>
    <button class="btn btn-outline-light filter-btn" data-filter="read">Read</button>
    <button class="btn btn-outline-light filter-btn" data-filter="unread">Unread</button>
  </div>
  

  <!-- Date Filter -->
  <div class="row filter-bar mb-4">
    <div class="col-md-4">
      <input type="date" class="form-control" id="startDate" />
    </div>
    <div class="col-md-4">
      <input type="date" class="form-control" id="endDate" />
    </div>
    <div class="col-md-4">
      <button class="btn btn-warning w-100" onclick="filterByDate()">üîç Filter by Date</button>
    </div>
  </div>

  <!-- Contact List -->
  <div id="contact-list"></div>

  <!-- Pagination -->
  <nav>
    <ul class="pagination mt-4" id="pagination"></ul>
  </nav>
</div>
</main>

<script>
  let allContacts = [];
  let filteredContacts = [];
  const contactsPerPage = 5;
  let currentPage = 1;
  let currentFilter = "all"; // all, read, unread


  async function fetchContacts() {
    const res = await fetch("http://127.0.0.1:5000/all-contacts");
    const data = await res.json();
    allContacts = data.contacts;
    filteredContacts = [...allContacts];
    renderPage(1);
  }
  document.querySelectorAll(".filter-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentFilter = btn.getAttribute("data-filter");
    filterByDate();
  });
});

  function renderPage(page) {
    currentPage = page;
    const start = (page - 1) * contactsPerPage;
    const end = start + contactsPerPage;
    const paginated = filteredContacts.slice(start, end);
    renderContacts(paginated);
    renderPagination();
  }

  function renderContacts(contacts) {
    const list = document.getElementById("contact-list");
    list.innerHTML = "";
    contacts.forEach(contact => {
      const isRead = contact.is_read;
      const readClass = isRead ? 'contact-read' : 'contact-unread';
      const card = document.createElement("div");
      card.className = `contact-card ${readClass}`;
      card.innerHTML = `
        <div class="contact-title">${contact.c_name} (${contact.c_email})</div>
        <div class="mb-2"><strong>Phone:</strong> ${contact.c_phone || "N/A"}</div>
        <p>${contact.c_text}</p>
        <small class="text-white-50">${new Date(contact.time).toLocaleString()}</small>
        ${!isRead ? `<button class="mark-read-btn" onclick="markAsRead(${contact.contact_id})">Mark as Read</button>` : ""}
      `;
      list.appendChild(card);
    });
  }

  function renderPagination() {
    const totalPages = Math.ceil(filteredContacts.length / contactsPerPage);
    const pagination = document.getElementById("pagination");
    pagination.innerHTML = "";

    for (let i = 1; i <= totalPages; i++) { 
      const li = document.createElement("li");
      li.className = `page-item ${i === currentPage ? "active" : ""}`;
      li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
      li.addEventListener("click", () => renderPage(i));
      pagination.appendChild(li);
    }
  }

  async function markAsRead(contactId) {
    await fetch(`http://127.0.0.1:5000/mark-contact-read/${contactId}`, {
      method: "PUT"
    });
    await fetchContacts(); // Refresh after marking
  }

  function filterByDate() {
  const start = document.getElementById("startDate").value;
  const end = document.getElementById("endDate").value;

  filteredContacts = allContacts.filter(contact => {
    const date = new Date(contact.time);
    const inRange = (!start || date >= new Date(start)) && (!end || date <= new Date(end + "T23:59:59"));

    if (currentFilter === "read") return contact.is_read && inRange;
    if (currentFilter === "unread") return !contact.is_read && inRange;
    return inRange; // all
  });

  renderPage(1);
}

  fetchContacts();
</script>

</body>
</html>
